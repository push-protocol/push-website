"use strict";(self.webpackChunkpush_website=self.webpackChunkpush_website||[]).push([[53883],{254318:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>d,contentTitle:()=>r,default:()=>u,frontMatter:()=>i,metadata:()=>o,toc:()=>l});var a=t(474848),s=t(28453);const i={id:"docs-notifications-showrunners-examples-defi-based-trigger",title:"DeFi based trigger",hide_title:!0,slug:"./defi-based-trigger",displayed_sidebar:"pushNotificationSidebar",sidebar_position:5,image:"/assets/docs/previews/docs_notifications_showrunners_examples--defi_based_trigger.png"},r="DeFi based trigger via showrunner scaffold",o={id:"notifications/showrunners-scaffold/Examples/docs-notifications-showrunners-examples-defi-based-trigger",title:"DeFi based trigger",description:"This is a step-by-step introductory tutorial that will teach you how to build a channel based on DEFI protocols and their respective events in a contract.",source:"@site/docs/notifications/04-showrunners-scaffold/03-Examples/05-Showrunner-Example-DeFi-Based-Trigger.mdx",sourceDirName:"notifications/04-showrunners-scaffold/03-Examples",slug:"/notifications/showrunners-scaffold/Examples/defi-based-trigger",permalink:"/push-website/pr-preview/pr-965/docs/notifications/showrunners-scaffold/Examples/defi-based-trigger",draft:!1,unlisted:!1,editUrl:"https://github.com/push-protocol/push-website/blob/main/docs/notifications/04-showrunners-scaffold/03-Examples/05-Showrunner-Example-DeFi-Based-Trigger.mdx",tags:[],version:"current",sidebarPosition:5,frontMatter:{id:"docs-notifications-showrunners-examples-defi-based-trigger",title:"DeFi based trigger",hide_title:!0,slug:"./defi-based-trigger",displayed_sidebar:"pushNotificationSidebar",sidebar_position:5,image:"/assets/docs/previews/docs_notifications_showrunners_examples--defi_based_trigger.png"},sidebar:"pushNotificationSidebar",previous:{title:"Offchain (Web2) based trigger",permalink:"/push-website/pr-preview/pr-965/docs/notifications/showrunners-scaffold/Examples/offchain-based-trigger"},next:{title:"Advance - Protocol based trigger (Oasis protocol)",permalink:"/push-website/pr-preview/pr-965/docs/notifications/showrunners-scaffold/Examples/advance-protocol-based-trigger-oasis-protocol"}},d={},l=[{value:"Pre-requisites",id:"pre-requisites",level:3},{value:"Use case for Notification: ",id:"use-case-for-notification-",level:4},{value:"Step 1. Setup channel folder",id:"step-1-setup-channel-folder",level:3},{value:"Step 2 . Adding necessary files into the folder",id:"step-2--adding-necessary-files-into-the-folder",level:3},{value:"Adding aaveSettings.json",id:"adding-aavesettingsjson",level:4},{value:"Adding aaveChannel.ts file",id:"adding-aavechannelts-file",level:4},{value:"Constructor Section",id:"constructor-section",level:4},{value:"Check HealthFactor section",id:"check-healthfactor-section",level:4},{value:"Send Message To Contract section",id:"send-message-to-contract-section",level:4},{value:"Setting up routes for our channel",id:"setting-up-routes-for-our-channel",level:4},{value:"Setting up jobs file for channel",id:"setting-up-jobs-file-for-channel",level:4},{value:"Setting up keys file for channel",id:"setting-up-keys-file-for-channel",level:4},{value:"Putting it all together",id:"putting-it-all-together",level:4}];function c(n){const e={a:"a",br:"br",code:"code",em:"em",h1:"h1",h3:"h3",h4:"h4",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...n.components},{Head:i}=e;return i||function(n,e){throw new Error("Expected "+(e?"component":"object")+" `"+n+"` to be defined: you likely forgot to import, pass, or provide it.")}("Head",!0),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e.h1,{id:"defi-based-trigger-via-showrunner-scaffold",children:"DeFi based trigger via showrunner scaffold"}),"\n",(0,a.jsx)(e.p,{children:"This is a step-by-step introductory tutorial that will teach you how to build a channel based on DEFI protocols and their respective events in a contract."}),"\n",(0,a.jsxs)(e.p,{children:["If you are new to Push protocol and don't have a proper idea of how to create a DEFI-based channel for notifications on top of ",(0,a.jsx)(e.a,{href:"/docs/notifications/showrunners-scaffold/get-started",children:"showrunners"}),". This guide is for you ;)"]}),"\n",(0,a.jsxs)(e.p,{children:["We will walk through coding and interacting with the ",(0,a.jsx)(e.a,{href:"https://aave.com/",children:"aave"})," smart contract for monitoring the events."]}),"\n",(0,a.jsx)(e.p,{children:"And don\u2019t worry if you don\u2019t understand what any these words mean yet, I'll explain everything!"}),"\n",(0,a.jsxs)(e.p,{children:["You can access the ",(0,a.jsx)(e.a,{href:"https://github.com/push-protocol/push-showrunners-framework-staging/tree/main/src/sample_showrunners/aave",children:"code"})," for the channel and get some vibe for how the code is looking !!"]}),"\n",(0,a.jsx)(i,{children:(0,a.jsx)("title",{children:"DeFi based trigger | Example | Showrunners Scaffold | Push Notifications |\n  Push Documentation"})}),"\n",(0,a.jsx)(e.h3,{id:"pre-requisites",children:"Pre-requisites"}),"\n",(0,a.jsx)(e.p,{children:"Here are the list of things you will require to make the channel up into the showrunners:"}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsxs)(e.li,{children:["Contract Address for ",(0,a.jsx)(e.strong,{children:"AAVE Lending Pool"})," on the ethereum main-network : ",(0,a.jsx)(e.em,{children:(0,a.jsx)(e.code,{children:"0x7d2768dE32b0b80b7a3454c06BdAc94A69DDc7A9"})})]}),"\n",(0,a.jsxs)(e.li,{children:["ABI for ",(0,a.jsx)(e.strong,{children:"AAVE Lending Pool"})," smart contract:"]}),"\n"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-jsx",children:"[\n  {\n    anonymous: false,\n    inputs: [\n      {\n        indexed: true,\n        internalType: 'address',\n        name: 'reserve',\n        type: 'address',\n      },\n      {\n        indexed: false,\n        internalType: 'address',\n        name: 'user',\n        type: 'address',\n      },\n      {\n        indexed: true,\n        internalType: 'address',\n        name: 'onBehalfOf',\n        type: 'address',\n      },\n      {\n        indexed: false,\n        internalType: 'uint256',\n        name: 'amount',\n        type: 'uint256',\n      },\n      {\n        indexed: false,\n        internalType: 'uint256',\n        name: 'borrowRateMode',\n        type: 'uint256',\n      },\n      {\n        indexed: false,\n        internalType: 'uint256',\n        name: 'borrowRate',\n        type: 'uint256',\n      },\n      {\n        indexed: true,\n        internalType: 'uint16',\n        name: 'referral',\n        type: 'uint16',\n      },\n    ],\n    name: 'Borrow',\n    type: 'event',\n  },\n  {\n    anonymous: false,\n    inputs: [\n      {\n        indexed: true,\n        internalType: 'address',\n        name: 'reserve',\n        type: 'address',\n      },\n      {\n        indexed: false,\n        internalType: 'address',\n        name: 'user',\n        type: 'address',\n      },\n      {\n        indexed: true,\n        internalType: 'address',\n        name: 'onBehalfOf',\n        type: 'address',\n      },\n      {\n        indexed: false,\n        internalType: 'uint256',\n        name: 'amount',\n        type: 'uint256',\n      },\n      {\n        indexed: true,\n        internalType: 'uint16',\n        name: 'referral',\n        type: 'uint16',\n      },\n    ],\n    name: 'Deposit',\n    type: 'event',\n  },\n  {\n    anonymous: false,\n    inputs: [\n      {\n        indexed: true,\n        internalType: 'address',\n        name: 'target',\n        type: 'address',\n      },\n      {\n        indexed: true,\n        internalType: 'address',\n        name: 'initiator',\n        type: 'address',\n      },\n      {\n        indexed: true,\n        internalType: 'address',\n        name: 'asset',\n        type: 'address',\n      },\n      {\n        indexed: false,\n        internalType: 'uint256',\n        name: 'amount',\n        type: 'uint256',\n      },\n      {\n        indexed: false,\n        internalType: 'uint256',\n        name: 'premium',\n        type: 'uint256',\n      },\n      {\n        indexed: false,\n        internalType: 'uint16',\n        name: 'referralCode',\n        type: 'uint16',\n      },\n    ],\n    name: 'FlashLoan',\n    type: 'event',\n  },\n  {\n    anonymous: false,\n    inputs: [\n      {\n        indexed: true,\n        internalType: 'address',\n        name: 'collateralAsset',\n        type: 'address',\n      },\n      {\n        indexed: true,\n        internalType: 'address',\n        name: 'debtAsset',\n        type: 'address',\n      },\n      {\n        indexed: true,\n        internalType: 'address',\n        name: 'user',\n        type: 'address',\n      },\n      {\n        indexed: false,\n        internalType: 'uint256',\n        name: 'debtToCover',\n        type: 'uint256',\n      },\n      {\n        indexed: false,\n        internalType: 'uint256',\n        name: 'liquidatedCollateralAmount',\n        type: 'uint256',\n      },\n      {\n        indexed: false,\n        internalType: 'address',\n        name: 'liquidator',\n        type: 'address',\n      },\n      {\n        indexed: false,\n        internalType: 'bool',\n        name: 'receiveAToken',\n        type: 'bool',\n      },\n    ],\n    name: 'LiquidationCall',\n    type: 'event',\n  },\n  {\n    anonymous: false,\n    inputs: [],\n    name: 'Paused',\n    type: 'event',\n  },\n  {\n    anonymous: false,\n    inputs: [\n      {\n        indexed: true,\n        internalType: 'address',\n        name: 'reserve',\n        type: 'address',\n      },\n      {\n        indexed: true,\n        internalType: 'address',\n        name: 'user',\n        type: 'address',\n      },\n    ],\n    name: 'RebalanceStableBorrowRate',\n    type: 'event',\n  },\n  {\n    anonymous: false,\n    inputs: [\n      {\n        indexed: true,\n        internalType: 'address',\n        name: 'reserve',\n        type: 'address',\n      },\n      {\n        indexed: true,\n        internalType: 'address',\n        name: 'user',\n        type: 'address',\n      },\n      {\n        indexed: true,\n        internalType: 'address',\n        name: 'repayer',\n        type: 'address',\n      },\n      {\n        indexed: false,\n        internalType: 'uint256',\n        name: 'amount',\n        type: 'uint256',\n      },\n    ],\n    name: 'Repay',\n    type: 'event',\n  },\n  {\n    anonymous: false,\n    inputs: [\n      {\n        indexed: true,\n        internalType: 'address',\n        name: 'reserve',\n        type: 'address',\n      },\n      {\n        indexed: false,\n        internalType: 'uint256',\n        name: 'liquidityRate',\n        type: 'uint256',\n      },\n      {\n        indexed: false,\n        internalType: 'uint256',\n        name: 'stableBorrowRate',\n        type: 'uint256',\n      },\n      {\n        indexed: false,\n        internalType: 'uint256',\n        name: 'variableBorrowRate',\n        type: 'uint256',\n      },\n      {\n        indexed: false,\n        internalType: 'uint256',\n        name: 'liquidityIndex',\n        type: 'uint256',\n      },\n      {\n        indexed: false,\n        internalType: 'uint256',\n        name: 'variableBorrowIndex',\n        type: 'uint256',\n      },\n    ],\n    name: 'ReserveDataUpdated',\n    type: 'event',\n  },\n  {\n    anonymous: false,\n    inputs: [\n      {\n        indexed: true,\n        internalType: 'address',\n        name: 'reserve',\n        type: 'address',\n      },\n      {\n        indexed: true,\n        internalType: 'address',\n        name: 'user',\n        type: 'address',\n      },\n    ],\n    name: 'ReserveUsedAsCollateralDisabled',\n    type: 'event',\n  },\n  {\n    anonymous: false,\n    inputs: [\n      {\n        indexed: true,\n        internalType: 'address',\n        name: 'reserve',\n        type: 'address',\n      },\n      {\n        indexed: true,\n        internalType: 'address',\n        name: 'user',\n        type: 'address',\n      },\n    ],\n    name: 'ReserveUsedAsCollateralEnabled',\n    type: 'event',\n  },\n  {\n    anonymous: false,\n    inputs: [\n      {\n        indexed: true,\n        internalType: 'address',\n        name: 'reserve',\n        type: 'address',\n      },\n      {\n        indexed: true,\n        internalType: 'address',\n        name: 'user',\n        type: 'address',\n      },\n      {\n        indexed: false,\n        internalType: 'uint256',\n        name: 'rateMode',\n        type: 'uint256',\n      },\n    ],\n    name: 'Swap',\n    type: 'event',\n  },\n  {\n    anonymous: false,\n    inputs: [],\n    name: 'Unpaused',\n    type: 'event',\n  },\n  {\n    anonymous: false,\n    inputs: [\n      {\n        indexed: true,\n        internalType: 'address',\n        name: 'reserve',\n        type: 'address',\n      },\n      {\n        indexed: true,\n        internalType: 'address',\n        name: 'user',\n        type: 'address',\n      },\n      {\n        indexed: true,\n        internalType: 'address',\n        name: 'to',\n        type: 'address',\n      },\n      {\n        indexed: false,\n        internalType: 'uint256',\n        name: 'amount',\n        type: 'uint256',\n      },\n    ],\n    name: 'Withdraw',\n    type: 'event',\n  },\n  {\n    inputs: [],\n    name: 'FLASHLOAN_PREMIUM_TOTAL',\n    outputs: [\n      {\n        internalType: 'uint256',\n        name: '',\n        type: 'uint256',\n      },\n    ],\n    stateMutability: 'view',\n    type: 'function',\n  },\n  {\n    inputs: [],\n    name: 'LENDINGPOOL_REVISION',\n    outputs: [\n      {\n        internalType: 'uint256',\n        name: '',\n        type: 'uint256',\n      },\n    ],\n    stateMutability: 'view',\n    type: 'function',\n  },\n  {\n    inputs: [],\n    name: 'MAX_NUMBER_RESERVES',\n    outputs: [\n      {\n        internalType: 'uint256',\n        name: '',\n        type: 'uint256',\n      },\n    ],\n    stateMutability: 'view',\n    type: 'function',\n  },\n  {\n    inputs: [],\n    name: 'MAX_STABLE_RATE_BORROW_SIZE_PERCENT',\n    outputs: [\n      {\n        internalType: 'uint256',\n        name: '',\n        type: 'uint256',\n      },\n    ],\n    stateMutability: 'view',\n    type: 'function',\n  },\n  {\n    inputs: [\n      {\n        internalType: 'address',\n        name: 'asset',\n        type: 'address',\n      },\n      {\n        internalType: 'uint256',\n        name: 'amount',\n        type: 'uint256',\n      },\n      {\n        internalType: 'uint256',\n        name: 'interestRateMode',\n        type: 'uint256',\n      },\n      {\n        internalType: 'uint16',\n        name: 'referralCode',\n        type: 'uint16',\n      },\n      {\n        internalType: 'address',\n        name: 'onBehalfOf',\n        type: 'address',\n      },\n    ],\n    name: 'borrow',\n    outputs: [],\n    stateMutability: 'nonpayable',\n    type: 'function',\n  },\n  {\n    inputs: [\n      {\n        internalType: 'address',\n        name: 'asset',\n        type: 'address',\n      },\n      {\n        internalType: 'uint256',\n        name: 'amount',\n        type: 'uint256',\n      },\n      {\n        internalType: 'address',\n        name: 'onBehalfOf',\n        type: 'address',\n      },\n      {\n        internalType: 'uint16',\n        name: 'referralCode',\n        type: 'uint16',\n      },\n    ],\n    name: 'deposit',\n    outputs: [],\n    stateMutability: 'nonpayable',\n    type: 'function',\n  },\n  {\n    inputs: [\n      {\n        internalType: 'address',\n        name: 'asset',\n        type: 'address',\n      },\n      {\n        internalType: 'address',\n        name: 'from',\n        type: 'address',\n      },\n      {\n        internalType: 'address',\n        name: 'to',\n        type: 'address',\n      },\n      {\n        internalType: 'uint256',\n        name: 'amount',\n        type: 'uint256',\n      },\n      {\n        internalType: 'uint256',\n        name: 'balanceFromBefore',\n        type: 'uint256',\n      },\n      {\n        internalType: 'uint256',\n        name: 'balanceToBefore',\n        type: 'uint256',\n      },\n    ],\n    name: 'finalizeTransfer',\n    outputs: [],\n    stateMutability: 'nonpayable',\n    type: 'function',\n  },\n  {\n    inputs: [\n      {\n        internalType: 'address',\n        name: 'receiverAddress',\n        type: 'address',\n      },\n      {\n        internalType: 'address[]',\n        name: 'assets',\n        type: 'address[]',\n      },\n      {\n        internalType: 'uint256[]',\n        name: 'amounts',\n        type: 'uint256[]',\n      },\n      {\n        internalType: 'uint256[]',\n        name: 'modes',\n        type: 'uint256[]',\n      },\n      {\n        internalType: 'address',\n        name: 'onBehalfOf',\n        type: 'address',\n      },\n      {\n        internalType: 'bytes',\n        name: 'params',\n        type: 'bytes',\n      },\n      {\n        internalType: 'uint16',\n        name: 'referralCode',\n        type: 'uint16',\n      },\n    ],\n    name: 'flashLoan',\n    outputs: [],\n    stateMutability: 'nonpayable',\n    type: 'function',\n  },\n  {\n    inputs: [],\n    name: 'getAddressesProvider',\n    outputs: [\n      {\n        internalType: 'contract ILendingPoolAddressesProvider',\n        name: '',\n        type: 'address',\n      },\n    ],\n    stateMutability: 'view',\n    type: 'function',\n  },\n  {\n    inputs: [\n      {\n        internalType: 'address',\n        name: 'asset',\n        type: 'address',\n      },\n    ],\n    name: 'getConfiguration',\n    outputs: [\n      {\n        components: [\n          {\n            internalType: 'uint256',\n            name: 'data',\n            type: 'uint256',\n          },\n        ],\n        internalType: 'struct DataTypes.ReserveConfigurationMap',\n        name: '',\n        type: 'tuple',\n      },\n    ],\n    stateMutability: 'view',\n    type: 'function',\n  },\n  {\n    inputs: [\n      {\n        internalType: 'address',\n        name: 'asset',\n        type: 'address',\n      },\n    ],\n    name: 'getReserveData',\n    outputs: [\n      {\n        components: [\n          {\n            components: [\n              {\n                internalType: 'uint256',\n                name: 'data',\n                type: 'uint256',\n              },\n            ],\n            internalType: 'struct DataTypes.ReserveConfigurationMap',\n            name: 'configuration',\n            type: 'tuple',\n          },\n          {\n            internalType: 'uint128',\n            name: 'liquidityIndex',\n            type: 'uint128',\n          },\n          {\n            internalType: 'uint128',\n            name: 'variableBorrowIndex',\n            type: 'uint128',\n          },\n          {\n            internalType: 'uint128',\n            name: 'currentLiquidityRate',\n            type: 'uint128',\n          },\n          {\n            internalType: 'uint128',\n            name: 'currentVariableBorrowRate',\n            type: 'uint128',\n          },\n          {\n            internalType: 'uint128',\n            name: 'currentStableBorrowRate',\n            type: 'uint128',\n          },\n          {\n            internalType: 'uint40',\n            name: 'lastUpdateTimestamp',\n            type: 'uint40',\n          },\n          {\n            internalType: 'address',\n            name: 'aTokenAddress',\n            type: 'address',\n          },\n          {\n            internalType: 'address',\n            name: 'stableDebtTokenAddress',\n            type: 'address',\n          },\n          {\n            internalType: 'address',\n            name: 'variableDebtTokenAddress',\n            type: 'address',\n          },\n          {\n            internalType: 'address',\n            name: 'interestRateStrategyAddress',\n            type: 'address',\n          },\n          {\n            internalType: 'uint8',\n            name: 'id',\n            type: 'uint8',\n          },\n        ],\n        internalType: 'struct DataTypes.ReserveData',\n        name: '',\n        type: 'tuple',\n      },\n    ],\n    stateMutability: 'view',\n    type: 'function',\n  },\n  {\n    inputs: [\n      {\n        internalType: 'address',\n        name: 'asset',\n        type: 'address',\n      },\n    ],\n    name: 'getReserveNormalizedIncome',\n    outputs: [\n      {\n        internalType: 'uint256',\n        name: '',\n        type: 'uint256',\n      },\n    ],\n    stateMutability: 'view',\n    type: 'function',\n  },\n  {\n    inputs: [\n      {\n        internalType: 'address',\n        name: 'asset',\n        type: 'address',\n      },\n    ],\n    name: 'getReserveNormalizedVariableDebt',\n    outputs: [\n      {\n        internalType: 'uint256',\n        name: '',\n        type: 'uint256',\n      },\n    ],\n    stateMutability: 'view',\n    type: 'function',\n  },\n  {\n    inputs: [],\n    name: 'getReservesList',\n    outputs: [\n      {\n        internalType: 'address[]',\n        name: '',\n        type: 'address[]',\n      },\n    ],\n    stateMutability: 'view',\n    type: 'function',\n  },\n  {\n    inputs: [\n      {\n        internalType: 'address',\n        name: 'user',\n        type: 'address',\n      },\n    ],\n    name: 'getUserAccountData',\n    outputs: [\n      {\n        internalType: 'uint256',\n        name: 'totalCollateralETH',\n        type: 'uint256',\n      },\n      {\n        internalType: 'uint256',\n        name: 'totalDebtETH',\n        type: 'uint256',\n      },\n      {\n        internalType: 'uint256',\n        name: 'availableBorrowsETH',\n        type: 'uint256',\n      },\n      {\n        internalType: 'uint256',\n        name: 'currentLiquidationThreshold',\n        type: 'uint256',\n      },\n      {\n        internalType: 'uint256',\n        name: 'ltv',\n        type: 'uint256',\n      },\n      {\n        internalType: 'uint256',\n        name: 'healthFactor',\n        type: 'uint256',\n      },\n    ],\n    stateMutability: 'view',\n    type: 'function',\n  },\n  {\n    inputs: [\n      {\n        internalType: 'address',\n        name: 'user',\n        type: 'address',\n      },\n    ],\n    name: 'getUserConfiguration',\n    outputs: [\n      {\n        components: [\n          {\n            internalType: 'uint256',\n            name: 'data',\n            type: 'uint256',\n          },\n        ],\n        internalType: 'struct DataTypes.UserConfigurationMap',\n        name: '',\n        type: 'tuple',\n      },\n    ],\n    stateMutability: 'view',\n    type: 'function',\n  },\n  {\n    inputs: [\n      {\n        internalType: 'address',\n        name: 'asset',\n        type: 'address',\n      },\n      {\n        internalType: 'address',\n        name: 'aTokenAddress',\n        type: 'address',\n      },\n      {\n        internalType: 'address',\n        name: 'stableDebtAddress',\n        type: 'address',\n      },\n      {\n        internalType: 'address',\n        name: 'variableDebtAddress',\n        type: 'address',\n      },\n      {\n        internalType: 'address',\n        name: 'interestRateStrategyAddress',\n        type: 'address',\n      },\n    ],\n    name: 'initReserve',\n    outputs: [],\n    stateMutability: 'nonpayable',\n    type: 'function',\n  },\n  {\n    inputs: [\n      {\n        internalType: 'contract ILendingPoolAddressesProvider',\n        name: 'provider',\n        type: 'address',\n      },\n    ],\n    name: 'initialize',\n    outputs: [],\n    stateMutability: 'nonpayable',\n    type: 'function',\n  },\n  {\n    inputs: [\n      {\n        internalType: 'address',\n        name: 'collateralAsset',\n        type: 'address',\n      },\n      {\n        internalType: 'address',\n        name: 'debtAsset',\n        type: 'address',\n      },\n      {\n        internalType: 'address',\n        name: 'user',\n        type: 'address',\n      },\n      {\n        internalType: 'uint256',\n        name: 'debtToCover',\n        type: 'uint256',\n      },\n      {\n        internalType: 'bool',\n        name: 'receiveAToken',\n        type: 'bool',\n      },\n    ],\n    name: 'liquidationCall',\n    outputs: [],\n    stateMutability: 'nonpayable',\n    type: 'function',\n  },\n  {\n    inputs: [],\n    name: 'paused',\n    outputs: [\n      {\n        internalType: 'bool',\n        name: '',\n        type: 'bool',\n      },\n    ],\n    stateMutability: 'view',\n    type: 'function',\n  },\n  {\n    inputs: [\n      {\n        internalType: 'address',\n        name: 'asset',\n        type: 'address',\n      },\n      {\n        internalType: 'address',\n        name: 'user',\n        type: 'address',\n      },\n    ],\n    name: 'rebalanceStableBorrowRate',\n    outputs: [],\n    stateMutability: 'nonpayable',\n    type: 'function',\n  },\n  {\n    inputs: [\n      {\n        internalType: 'address',\n        name: 'asset',\n        type: 'address',\n      },\n      {\n        internalType: 'uint256',\n        name: 'amount',\n        type: 'uint256',\n      },\n      {\n        internalType: 'uint256',\n        name: 'rateMode',\n        type: 'uint256',\n      },\n      {\n        internalType: 'address',\n        name: 'onBehalfOf',\n        type: 'address',\n      },\n    ],\n    name: 'repay',\n    outputs: [\n      {\n        internalType: 'uint256',\n        name: '',\n        type: 'uint256',\n      },\n    ],\n    stateMutability: 'nonpayable',\n    type: 'function',\n  },\n  {\n    inputs: [\n      {\n        internalType: 'address',\n        name: 'asset',\n        type: 'address',\n      },\n      {\n        internalType: 'uint256',\n        name: 'configuration',\n        type: 'uint256',\n      },\n    ],\n    name: 'setConfiguration',\n    outputs: [],\n    stateMutability: 'nonpayable',\n    type: 'function',\n  },\n  {\n    inputs: [\n      {\n        internalType: 'bool',\n        name: 'val',\n        type: 'bool',\n      },\n    ],\n    name: 'setPause',\n    outputs: [],\n    stateMutability: 'nonpayable',\n    type: 'function',\n  },\n  {\n    inputs: [\n      {\n        internalType: 'address',\n        name: 'asset',\n        type: 'address',\n      },\n      {\n        internalType: 'address',\n        name: 'rateStrategyAddress',\n        type: 'address',\n      },\n    ],\n    name: 'setReserveInterestRateStrategyAddress',\n    outputs: [],\n    stateMutability: 'nonpayable',\n    type: 'function',\n  },\n  {\n    inputs: [\n      {\n        internalType: 'address',\n        name: 'asset',\n        type: 'address',\n      },\n      {\n        internalType: 'bool',\n        name: 'useAsCollateral',\n        type: 'bool',\n      },\n    ],\n    name: 'setUserUseReserveAsCollateral',\n    outputs: [],\n    stateMutability: 'nonpayable',\n    type: 'function',\n  },\n  {\n    inputs: [\n      {\n        internalType: 'address',\n        name: 'asset',\n        type: 'address',\n      },\n      {\n        internalType: 'uint256',\n        name: 'rateMode',\n        type: 'uint256',\n      },\n    ],\n    name: 'swapBorrowRateMode',\n    outputs: [],\n    stateMutability: 'nonpayable',\n    type: 'function',\n  },\n  {\n    inputs: [\n      {\n        internalType: 'address',\n        name: 'asset',\n        type: 'address',\n      },\n      {\n        internalType: 'uint256',\n        name: 'amount',\n        type: 'uint256',\n      },\n      {\n        internalType: 'address',\n        name: 'to',\n        type: 'address',\n      },\n    ],\n    name: 'withdraw',\n    outputs: [\n      {\n        internalType: 'uint256',\n        name: '',\n        type: 'uint256',\n      },\n    ],\n    stateMutability: 'nonpayable',\n    type: 'function',\n  },\n];\n"})}),"\n",(0,a.jsx)(e.h4,{id:"use-case-for-notification-",children:"Use case for Notification: "}),"\n",(0,a.jsxs)(e.p,{children:["So before implementing the notifications we should know what exactly our use case is for the notifications.\nHere we are working on notifying users whenever their loans are approaching liquidity. If you take a look into the contract ",(0,a.jsx)(e.a,{href:"https://etherscan.io/address/0x7d2768de32b0b80b7a3454c06bdac94a69ddc7a9#readProxyContract",children:"here"}),", There is a ",(0,a.jsx)(e.code,{children:"getUserAccountData"})," method which returns data following the schema: ",(0,a.jsx)(e.code,{children:"{ totalCollateralETH`` "}),(0,a.jsx)(e.em,{children:(0,a.jsx)(e.code,{children:"uint256"})}),(0,a.jsx)(e.code,{children:", totalDebtETH`` "}),(0,a.jsx)(e.em,{children:(0,a.jsx)(e.code,{children:"uint256"})}),(0,a.jsx)(e.code,{children:", availableBorrowsETH`` "}),(0,a.jsx)(e.em,{children:(0,a.jsx)(e.code,{children:"uint256"})}),(0,a.jsx)(e.code,{children:", currentLiquidationThreshold`` "}),(0,a.jsx)(e.em,{children:(0,a.jsx)(e.code,{children:"uint256"})}),(0,a.jsx)(e.code,{children:", ltv`` "}),(0,a.jsx)(e.em,{children:(0,a.jsx)(e.code,{children:"uint256"})}),(0,a.jsx)(e.code,{children:", healthFactor`` "}),(0,a.jsx)(e.em,{children:(0,a.jsx)(e.code,{children:"uint256 }"})})," ."]}),"\n",(0,a.jsxs)(e.p,{children:[" it contains a parameter ",(0,a.jsx)(e.code,{children:"healthFactor"})," parameter, which we monitor until it goes below a defined threshold, and then we send a notification to the subscriber/user in question."]}),"\n",(0,a.jsx)(e.p,{children:"Don't worry if that's a bit overwhelming at this point, you'll see how these things work in action!"}),"\n",(0,a.jsx)(e.p,{children:"Now buckle up, and let's get started."}),"\n",(0,a.jsx)(e.h3,{id:"step-1-setup-channel-folder",children:"Step 1. Setup channel folder"}),"\n",(0,a.jsx)(e.p,{children:"For starting with showrunners and setting it up follow this guide here. // need to add link"}),"\n",(0,a.jsxs)(e.p,{children:["First we need to create a folder in ",(0,a.jsx)(e.code,{children:"src/showrunners/<"}),(0,a.jsx)(e.em,{children:(0,a.jsx)(e.code,{children:"your_channel_name>"})})]}),"\n",(0,a.jsxs)(e.p,{children:["In our case the name of the folder we are going to create is ",(0,a.jsx)(e.code,{children:"AAVE"})," as that is the name of the channel we plan to create."]}),"\n",(0,a.jsx)(e.h3,{id:"step-2--adding-necessary-files-into-the-folder",children:"Step 2 . Adding necessary files into the folder"}),"\n",(0,a.jsx)(e.h4,{id:"adding-aavesettingsjson",children:"Adding aaveSettings.json"}),"\n",(0,a.jsxs)(e.p,{children:["Now that we have created the folder, it's time for creating files in the folder. Start with creating ",(0,a.jsx)(e.code,{children:"aaveSettings.json"})," and put the following contents in it, which are the addresses of the lending pool contract on different networks."]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-jsx",children:'{\n    "aaveLendingPoolDeployedContractPolygonMainnet": "0x8dFf5E27EA6b7AC08EbFdf9eB090F32ee9a30fcf",\n    "aaveLendingPoolDeployedContractPolygonMumbai": "0x9198F13B08E299d85E096929fA9781A1E3d5d827",\n    "aaveLendingPoolDeployedContractMainnet": "0x7d2768dE32b0b80b7a3454c06BdAc94A69DDc7A9",\n    "aaveLendingPoolDeployedContractKovan": "0xE0fBa4Fc209b4948668006B2bE61711b7f465bAe"\n}\n'})}),"\n",(0,a.jsx)(e.p,{children:"If you need to monitor more EVM networks, we can add more contract address here."}),"\n",(0,a.jsx)(e.h4,{id:"adding-aavechannelts-file",children:"Adding aaveChannel.ts file"}),"\n",(0,a.jsxs)(e.p,{children:["We will create our main file for monitoring our events, Name the files as ",(0,a.jsx)(e.code,{children:"<channel_name>Channel.ts,"})," in our case it will be aave",(0,a.jsx)(e.code,{children:"Channel.ts"})," ."]}),"\n",(0,a.jsxs)(e.p,{children:["In ",(0,a.jsx)(e.code,{children:"aaveChannel.ts"}),", we can see our example code."]}),"\n",(0,a.jsx)(e.p,{children:"Let's review it to understand a bit about what's going on in code!"}),"\n",(0,a.jsx)(e.p,{children:"Here's the entire code:"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-jsx",children:"// @name: Aave Channel\n// @version: 1.0\n\nimport { Service, Inject } from 'typedi';\nimport config, { defaultSdkSettings, settings } from '../../config';\nimport { ethers } from 'ethers';\nimport epnsHelper from '@epnsproject/backend-sdk-staging';\nimport aaveSettings from './aaveSettings.json';\nimport aaveLendingPoolDeployedContractABI from './aave_LendingPool.json';\nimport { EPNSChannel } from '../../helpers/epnschannel';\nimport { Logger } from 'winston';\n\nconst NETWORK_TO_MONITOR = config.web3MainnetNetwork;\nconst HEALTH_FACTOR_THRESHOLD = 1.6;\nconst CUSTOMIZABLE_SETTINGS = {\n  precision: 3,\n};\n\n@Service()\nexport default class AaveChannel extends EPNSChannel {\n  constructor(@Inject('logger') public logger: Logger) {\n    super(logger, {\n      sdkSettings: {\n        epnsCoreSettings: defaultSdkSettings.epnsCoreSettings,\n        epnsCommunicatorSettings: defaultSdkSettings.epnsCommunicatorSettings,\n        networkSettings: defaultSdkSettings.networkSettings,\n      },\n      networkToMonitor: NETWORK_TO_MONITOR,\n      dirname: __dirname,\n      name: 'Aave',\n      url: 'https://aave.com/',\n      useOffChain: true,\n    });\n  }\n\n  // To form and write to smart contract\n  public async sendMessageToNode(simulate) {\n    const sdk = await this.getSdk();\n    this.logInfo('sendMessageToNode');\n\n    //simulate object settings START\n    const logicOverride =\n      typeof simulate == 'object'\n        ? simulate.hasOwnProperty('logicOverride') && simulate.logicOverride.mode\n          ? simulate.logicOverride.mode\n          : false\n        : false;\n    const simulateAaveNetwork =\n      logicOverride && simulate.logicOverride.hasOwnProperty('aaveNetwork')\n        ? simulate.logicOverride.aaveNetwork\n        : false;\n    let aave: any;\n    if (simulateAaveNetwork) {\n      this.logInfo('Using Simulated Aave Network');\n      aave = sdk.advanced.getInteractableContracts(\n        simulateAaveNetwork,\n        settings,\n        this.walletKey,\n        aaveSettings.aaveLendingPoolDeployedContractMainnet,\n        aaveLendingPoolDeployedContractABI,\n      );\n    } else {\n      this.logInfo('Getting Aave Contract');\n      aave = await sdk.getContract(\n        aaveSettings.aaveLendingPoolDeployedContractMainnet,\n        JSON.stringify(aaveLendingPoolDeployedContractABI),\n      );\n      this.log(`Got Contract`);\n    }\n\n    this.logInfo(`Getting subscribed users`);\n\n    const users = await sdk.getSubscribedUsers();\n    for (const user of users) {\n      let res = await this.checkHealthFactor(aave, user, sdk, simulate);\n    }\n\n    return true;\n  }\n\n  public async checkHealthFactor(aave, userAddress, sdk: epnsHelper, simulate) {\n    this.logInfo(`Checking Health Factor`);\n    try {\n      const logicOverride =\n        typeof simulate == 'object'\n          ? simulate.hasOwnProperty('logicOverride') && simulate.logicOverride.mode\n            ? simulate.logicOverride.mode\n            : false\n          : false;\n      const simulateApplyToAddr =\n        logicOverride && simulate.logicOverride.hasOwnProperty('applyToAddr')\n          ? simulate.logicOverride.applyToAddr\n          : false;\n      const simulateAaveNetwork =\n        logicOverride && simulate.logicOverride.hasOwnProperty('aaveNetwork')\n          ? simulate.logicOverride.aaveNetwork\n          : false;\n\n      if (!aave) {\n        aave = await sdk.getContract(\n          aaveSettings.aaveLendingPoolDeployedContractMainnet,\n          JSON.stringify(aaveLendingPoolDeployedContractABI),\n        );\n      }\n      if (!userAddress) {\n        if (simulateApplyToAddr) {\n          userAddress = simulateApplyToAddr;\n        } else {\n          this.logDebug('userAddress is not defined');\n        }\n      }\n    } catch (err) {\n      this.logError('An error occured while checking health factor');\n      this.logError(err);\n    }\n    //simulate object settings END\n\n    const userData = await aave.contract.getUserAccountData(userAddress);\n    let healthFactor = ethers.utils.formatEther(userData.healthFactor);\n    this.logInfo('For wallet: %s, Health Factor: %o', userAddress, healthFactor);\n    if (Number(healthFactor) <= HEALTH_FACTOR_THRESHOLD) {\n      const precision = CUSTOMIZABLE_SETTINGS.precision;\n      const newHealthFactor = parseFloat(healthFactor).toFixed(precision);\n      const title = 'Aave Liquidity Alert!';\n      const message =\n        userAddress +\n        ' your account has healthFactor ' +\n        newHealthFactor +\n        '. Maintain it above 1 to avoid liquidation.';\n      const payloadTitle = 'Aave Liquidity Alert!';\n      const payloadMsg = `Your account has healthFactor [b:${newHealthFactor}] . Maintain it above 1 to avoid liquidation.[timestamp: ${Math.floor(\n        Date.now() / 1000,\n      )}]`;\n      const notificationType = 3;\n      const tx = await this.sendNotification({\n        recipient: userAddress,\n        title: title,\n        message: message,\n        payloadTitle: payloadTitle,\n        payloadMsg: payloadMsg,\n        notificationType: notificationType,\n        cta: 'https://app.aave.com/#/dashboard',\n        image: null,\n        simulate: simulate,\n      });\n\n      return {\n        success: true,\n        data: tx,\n      };\n    } else {\n      this.logInfo(`[Wallet: ${userAddress} is SAFE with Health Factor:: ${healthFactor}`);\n      return {\n        success: false,\n        data: userAddress + ' is not about to get liquidated',\n      };\n    }\n  }\n}\n\n"})}),"\n",(0,a.jsx)(e.p,{children:"Let's break it down into sections so we can have better understanding of code.:thumbsup::thumbsup:"}),"\n",(0,a.jsx)(e.h4,{id:"constructor-section",children:"Constructor Section"}),"\n",(0,a.jsxs)(e.p,{children:["The constructor of the class is used to initialise a lot of key variables which are specific to this channel, the key things to note are ",(0,a.jsx)(e.code,{children:"name"})," which represents the name of the channel, ",(0,a.jsx)(e.code,{children:"url"})," which is essentially the home page(if any) of the channel, this would the where the users would be redirected to by default, if no CTA is provided for a notification."]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-jsx",children:"// The constructor of the class\n  constructor(@Inject('logger') public logger: Logger) {\n    super(logger, {\n      sdkSettings: {\n        epnsCoreSettings: defaultSdkSettings.epnsCoreSettings,\n        epnsCommunicatorSettings: defaultSdkSettings.epnsCommunicatorSettings,\n        networkSettings: defaultSdkSettings.networkSettings,\n      },\n      networkToMonitor: NETWORK_TO_MONITOR,\n      dirname: __dirname,\n      name: 'Aave',\n      url: 'https://aave.com/',\n      useOffChain: true,\n    });\n  }\n"})}),"\n",(0,a.jsx)(e.h4,{id:"check-healthfactor-section",children:"Check HealthFactor section"}),"\n",(0,a.jsxs)(e.p,{children:["This is a utility function responsible for checking, it essentially takes in a user address, and then fetches details about the position associated with the address.",(0,a.jsx)(e.br,{}),"\n","Among the details fetched for the user is the variable ",(0,a.jsx)(e.code,{children:"healthFactor"})," which tells us how close this user is to liquidation, where a value of ",(0,a.jsx)(e.code,{children:"1"})," means the user is not close to liquidation and a value of ",(0,a.jsx)(e.code,{children:"0"})," means the user is liquidated. We then compare the value gotten back to a cut-off value, and if it falls below the cut-off value, we trigger a notification to the user in question."]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-jsx",children:"  public async checkHealthFactor(aave, userAddress, sdk: epnsHelper, simulate) {\n    this.logInfo(`Checking Health Factor`);\n    try {\n      const logicOverride =\n        typeof simulate == 'object'\n          ? simulate.hasOwnProperty('logicOverride') && simulate.logicOverride.mode\n            ? simulate.logicOverride.mode\n            : false\n          : false;\n      const simulateApplyToAddr =\n        logicOverride && simulate.logicOverride.hasOwnProperty('applyToAddr')\n          ? simulate.logicOverride.applyToAddr\n          : false;\n      const simulateAaveNetwork =\n        logicOverride && simulate.logicOverride.hasOwnProperty('aaveNetwork')\n          ? simulate.logicOverride.aaveNetwork\n          : false;\n\n      if (!aave) {\n        aave = await sdk.getContract(\n          aaveSettings.aaveLendingPoolDeployedContractMainnet,\n          JSON.stringify(aaveLendingPoolDeployedContractABI),\n        );\n      }\n      if (!userAddress) {\n        if (simulateApplyToAddr) {\n          userAddress = simulateApplyToAddr;\n        } else {\n          this.logDebug('userAddress is not defined');\n        }\n      }\n    } catch (err) {\n      this.logError('An error occured while checking health factor');\n      this.logError(err);\n    }\n    //simulate object settings END\n\n    const userData = await aave.contract.getUserAccountData(userAddress);\n    let healthFactor = ethers.utils.formatEther(userData.healthFactor);\n    this.logInfo('For wallet: %s, Health Factor: %o', userAddress, healthFactor);\n    if (Number(healthFactor) <= HEALTH_FACTOR_THRESHOLD) {\n      const precision = CUSTOMIZABLE_SETTINGS.precision;\n      const newHealthFactor = parseFloat(healthFactor).toFixed(precision);\n      const title = 'Aave Liquidity Alert!';\n      const message =\n        userAddress +\n        ' your account has healthFactor ' +\n        newHealthFactor +\n        '. Maintain it above 1 to avoid liquidation.';\n      const payloadTitle = 'Aave Liquidity Alert!';\n      const payloadMsg = `Your account has healthFactor [b:${newHealthFactor}] . Maintain it above 1 to avoid liquidation.[timestamp: ${Math.floor(\n        Date.now() / 1000,\n      )}]`;\n      const notificationType = 3;\n      const tx = await this.sendNotification({\n        recipient: userAddress,\n        title: title,\n        message: message,\n        payloadTitle: payloadTitle,\n        payloadMsg: payloadMsg,\n        notificationType: notificationType,\n        cta: 'https://app.aave.com/#/dashboard',\n        image: null,\n        simulate: simulate,\n      });\n\n      return {\n        success: true,\n        data: tx,\n      };\n    } else {\n      this.logInfo(`[Wallet: ${userAddress} is SAFE with Health Factor:: ${healthFactor}`);\n      return {\n        success: false,\n        data: userAddress + ' is not about to get liquidated',\n      };\n    }\n  }\n"})}),"\n",(0,a.jsx)(e.h4,{id:"send-message-to-contract-section",children:"Send Message To Contract section"}),"\n",(0,a.jsxs)(e.p,{children:["This is the ",(0,a.jsx)(e.code,{children:"main"})," function which is ties everything together and is called by an external party in order to perform the duties of the channel, this function loops over the subscribers of the channel, and calls the ",(0,a.jsx)(e.code,{children:"checkHealthFactor"})," method on them, which in turn then fetches"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-jsx",children:"  public async sendMessageToNode(simulate) {\n    const sdk = await this.getSdk();\n    this.logInfo('sendMessageToNode');\n\n    //simulate object settings START\n    const logicOverride =\n      typeof simulate == 'object'\n        ? simulate.hasOwnProperty('logicOverride') && simulate.logicOverride.mode\n          ? simulate.logicOverride.mode\n          : false\n        : false;\n    const simulateAaveNetwork =\n      logicOverride && simulate.logicOverride.hasOwnProperty('aaveNetwork')\n        ? simulate.logicOverride.aaveNetwork\n        : false;\n    let aave: any;\n    if (simulateAaveNetwork) {\n      this.logInfo('Using Simulated Aave Network');\n      aave = sdk.advanced.getInteractableContracts(\n        simulateAaveNetwork,\n        settings,\n        this.walletKey,\n        aaveSettings.aaveLendingPoolDeployedContractMainnet,\n        aaveLendingPoolDeployedContractABI,\n      );\n    } else {\n      this.logInfo('Getting Aave Contract');\n      aave = await sdk.getContract(\n        aaveSettings.aaveLendingPoolDeployedContractMainnet,\n        JSON.stringify(aaveLendingPoolDeployedContractABI),\n      );\n      this.log(`Got Contract`);\n    }\n\n    this.logInfo(`Getting subscribed users`);\n\n    const users = await sdk.getSubscribedUsers();\n    for (const user of users) {\n      let res = await this.checkHealthFactor(aave, user, sdk, simulate);\n    }\n\n    return true;\n  }\n\n"})}),"\n",(0,a.jsx)(e.h4,{id:"setting-up-routes-for-our-channel",children:"Setting up routes for our channel"}),"\n",(0,a.jsxs)(e.p,{children:["Now to trigger notification manually, we will be needing a ",(0,a.jsx)(e.code,{children:"channelRoute.ts"})," file."]}),"\n",(0,a.jsxs)(e.p,{children:["Here is the code for our ",(0,a.jsx)(e.code,{children:"aaveRoute.ts"})," file -"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-jsx",children:"import { Router, Request, Response, NextFunction } from 'express';\nimport { Container } from 'typedi';\nimport middlewares from '../../api/middlewares';\nimport { celebrate, Joi } from 'celebrate';\nimport aaveChannel from './aaveChannel';\nimport { Logger } from 'winston';\nimport { handleResponse } from '../../helpers/utilsHelper';\n\nconst route = Router();\n\nexport default (app: Router) => {\n  app.use('/showrunners/aave', route);\n\n  /**\n   * Send Message\n   * @description Send a notification via the aave showrunner\n   * @param {boolean} simulate whether to send the actual message or simulate message sending\n   */\n  route.post(\n    '/send_message',\n    celebrate({\n      body: Joi.object({\n        simulate: [Joi.bool(), Joi.object()],\n      }),\n    }),\n    middlewares.onlyLocalhost,\n    async (req: Request, res: Response, next: NextFunction) => {\n      const logger: Logger = Container.get('logger');\n      logger.debug('Calling /showrunners/aave/send_message endpoint with body: %o', req.body);\n      try {\n        const aave = Container.get(aaveChannel);\n        const data = await aave.sendMessageToNode(req.body.simulate);\n        return res.status(200).json({ success: true, data: data });\n      } catch (e) {\n        logger.error('\ud83d\udd25 error: %o', e);\n        return handleResponse(res, 500, false, 'error', JSON.stringify(e));\n      }\n    },\n  );\n};\n\n"})}),"\n",(0,a.jsx)(e.h4,{id:"setting-up-jobs-file-for-channel",children:"Setting up jobs file for channel"}),"\n",(0,a.jsx)(e.p,{children:"Now that we have done with routes file, lets have a demo jobs file which will hit our function every 20 minutes."}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.em,{children:"Setting up a jobs file for a channel is not necessary, it can be customized according to the use case"})}),"\n",(0,a.jsxs)(e.p,{children:["Code for the aave",(0,a.jsx)(e.code,{children:"Jobs.ts"})," -"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-jsx",children:"// Do Scheduling\n// https://github.com/node-schedule/node-schedule\n// *    *    *    *    *    *\n// \u252c    \u252c    \u252c    \u252c    \u252c    \u252c\n// \u2502    \u2502    \u2502    \u2502    \u2502    \u2502\n// \u2502    \u2502    \u2502    \u2502    \u2502    \u2514 day of week (0 - 7) (0 or 7 is Sun)\n// \u2502    \u2502    \u2502    \u2502    \u2514\u2500\u2500\u2500\u2500\u2500 month (1 - 12)\n// \u2502    \u2502    \u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 day of month (1 - 31)\n// \u2502    \u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 hour (0 - 23)\n// \u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 minute (0 - 59)\n// \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 second (0 - 59, OPTIONAL)\n// Execute a cron job every 5 Minutes = */5 * * * *\n// Starts from seconds = * * * * * *\n\nimport config from '../../config';\nimport logger from '../../loaders/logger';\n\nimport { Container } from 'typedi';\nimport schedule from 'node-schedule';\n\nimport AaveChannel from './aaveChannel';\n\nexport default () => {\n  const startTime = new Date(new Date().setHours(0, 0, 0, 0));\n\n  const dailyRule = new schedule.RecurrenceRule();\n  dailyRule.hour = 0;\n  dailyRule.minute = 0;\n  dailyRule.second = 0;\n  dailyRule.dayOfWeek = new schedule.Range(0, 6);\n\n  // AAVE CHANNEL RUNS EVERY 24 Hours\n  logger.info(\n    `     \ud83d\udef5 Scheduling Showrunner - Aave Channel [on 6 Hours] [${new Date(Date.now())}]`\n  );\n  schedule.scheduleJob(\n    { start: startTime, rule: dailyRule },\n    async function () {\n      const aaveChannel = Container.get(AaveChannel);\n      const taskName = 'Aave users address checks and sendMessageToNode()';\n\n      try {\n        await aaveChannel.sendMessageToNode(false);\n        logger.info(\n          `[${new Date(Date.now())}] \ud83d\udc23 Cron Task Completed -- ${taskName}`\n        );\n      } catch (err) {\n        logger.error(\n          `[${new Date(Date.now())}] \u274c Cron Task Failed -- ${taskName}`\n        );\n        logger.error(`[${new Date(Date.now())}] Error Object: %o`, err);\n      }\n    }\n  );\n};\n"})}),"\n",(0,a.jsx)(e.h4,{id:"setting-up-keys-file-for-channel",children:"Setting up keys file for channel"}),"\n",(0,a.jsx)(e.p,{children:"This file would be named aaveKeys.json, and it would contain the private keys of the channel"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-jsx",children:'{\n    "PRIVATE_KEY": "0x_PRIVATE_KEY"\n}\n'})}),"\n",(0,a.jsx)(e.h4,{id:"putting-it-all-together",children:"Putting it all together"}),"\n",(0,a.jsx)(e.p,{children:"At the end of the day, you should have a file structure which looks this way:"}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{src:t(40842).A+"",width:"460",height:"260"})}),"\n",(0,a.jsxs)(e.p,{children:["You can now heat up the server by running ",(0,a.jsx)(e.code,{children:"docker-compose up"})," and ",(0,a.jsx)(e.code,{children:"npm run dev"})," and start sending notification."]}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsxs)(e.em,{children:["In the channel file you can also track the block numbers for which last notification by using ",(0,a.jsx)(e.code,{children:"database"})," , so that next time the jobs hit the engine, it won't repeat sending notification from same block again i.e. repeated notifications"]})}),"\n",(0,a.jsx)(e.p,{children:"That's all for now :)"}),"\n",(0,a.jsxs)(e.p,{children:["If you enjoyed this tutorial, Do join our ",(0,a.jsx)(e.a,{href:"https://discord.com/invite/pushprotocol",children:"discord server"})," to meet other dev and builders."]})]})}function u(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,a.jsx)(e,{...n,children:(0,a.jsx)(c,{...n})}):c(n)}},40842:(n,e,t)=>{t.d(e,{A:()=>a});const a=t.p+"assets/images/image (12)-6c9c3157cabb694c774277fc6b55272d.png"},28453:(n,e,t)=>{t.d(e,{R:()=>r,x:()=>o});var a=t(296540);const s={},i=a.createContext(s);function r(n){const e=a.useContext(i);return a.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:r(n.components),a.createElement(i.Provider,{value:e},n.children)}}}]);